# Memory Intensive - n1-highmem-8 (?)
# 32GB / 4 Core
# General Purpose - n1-standard-8
# 32GB / 8 Core
# CPU Intensive - n1-highcpu-16 (n1-highcpu-32)
# 32GB / 16 Cores



# JovainX API Compatibility
# v1
jovianx_api_version: v1

# Name of this SaaS application
# string
application_name: InsightEdge

# version of this JovianX blueprint
# semantic versioning
version: 0.0.8

main_endpoint_component: insightedge
application_launch_timeout:
  tries_count: 120
  seconds_between_tries: 5

components:
  - name: feeder
    version: 1.0.0
    provider: helm_chart
    helm_chart_name: feeder
    helm_set:
      - key: kafka.url
        value: "{{ account://vendor_company }}--{{account://end_company}}--kafka-headless:9092"
  - name: kafka
    version: 1.0.0
    provider: helm_chart
    helm_chart_name: kafka
    helm_set:
      - key: zookeeper.url
        value: "{{ account://vendor_company }}--{{account://end_company}}--insightedge-insightedge-manager-hs"
  - name: insightedge
    version: 1.0.0
    provider: helm_chart 
    helm_chart_name: insightedge
    helm_set:
      - key: pu.partitions
        value: 6
      - key: vendor_company
        value: '{{ account://vendor_company }}'
      - key: end_company
        value: '{{ account://end_company }}'
      - key: account_api_key
        value: '{{ account://account_api_key }}'
      - key: admin_email
        value: '{{ account://admin_email }}'
      - key: admin_password
        value: '{{ account://admin_password }}'
      - key: api_host
        value: '{{ account://api_host }}'
    endpoints:
      - name: 'Getting Started app'
        service_name: "{{ account://vendor_company }}--{{account://end_company}}--insightedge-insightedge-zeppelin-service"
        port: 9090
        path: /#/notebook/2EQ7XUSYW
        type: entry_point
        dns: '{{ account://end_company }}.cloud.gigaspaces.com'

settings_descriptors:
  - name: cloudProvider
    display: 'Cloud Provider'
    input_type: radio
    default: gcp
    description_title: 'Choose your provider'
    select_options:
      - name: azure
        display: 'Microsoft Azure'
        img: 'https://www.mongodb.com/assets/images/cloud/atlas/logos/azure.png'
        components:
          - name: insightedge
            helm_set:
              - key: cloudProvider
                value: azure
          - name: insightedge
            helm_set:
              - key: enable
                value: azure
      - name: aws
        display: 'Amazon Web Services'
        img: 'https://www.mongodb.com/assets/images/cloud/atlas/logos/aws.png'
        components:
          - name: insightedge
            helm_set:
              - key: cloudProvider
                value: aws
          - name: insightedge
            helm_set:
              - key: enable
                value: aws
      - name: gcp
        display: 'Google Cloud Platform'
        img: 'https://www.mongodb.com/assets/images/cloud/atlas/logos/gcp.png'
        components:
          - name: insightedge
            helm_set:
              - key: cloudProvider
                value: gcp
          - name: insightedge
            helm_set:
              - key: enable
                value: gcp
  - name: workload_type
    display: "Workload type"
    input_type: select
    default: general
    select_options:
      - name: general
        display: 'General-purpose'
        components:
          - name: insightedge
            helm_set:
              - key: workload
                value: general
      - name: compute
        display: 'Compute-optimized'
        components:
          - name: insightedge
            helm_set:
              - key: workload
                value: compute
      - name: memory
        display: 'Memory-optimized'
        components:
          - name: insightedge
            helm_set:
              - key: workload
                value: memory
  - name: storage_performance
    display: "Storage performance"
    input_type: select
    default: general
    select_options:
      - name: general
        display: 'Standard persistent disks'
        components:
          - name: insightedge
            helm_set:
              - key: workload
                value: general
      - name: ssd-persistent
        display: 'SSD persistent disks'
        components:
          - name: insightedge
            helm_set:
              - key: workload
                value: ssd-persistent
      - name: ssd-scsi
        display: 'Local SSD (SCSI)'
        components:
          - name: insightedge
            helm_set:
              - key: workload
                value: ssd-scsi
      - name: ssd-nvme
        display: 'Local SSD (NVMe)'
        components:
          - name: insightedge
            helm_set:
              - key: workload
                value: ssd-nvme
  - name: ha
    display: 'High availability for InsightEdge Manager'
    input_type: checkbox
    default: false
    select_options:
      - name: true
        components:
          - name: insightedge
            helm_set:
              - key: manager.ha #we used "short-names" (not insightedge-manager) because _helpers.tpl has ".Values.nameOverride"
                value: true
      - name: false
        components:
          - name: insightedge
            helm_set:
              - key: manager.ha
                value: false
  - name: memoryxtend
    display: 'MemoryXtend'
    input_type: checkbox
    default: false
    description_title: 'MemoryXtend'
    description_explanations: 'The MemoryXtend storage model allows an external storage medium to store the Space data'
    select_options:
      - name: true
        components:
          - name: insightedge
            helm_set:
              - key: pu.memoryXtendVolume.enabled
                value: true
      - name: false
        components:
          - name: insightedge
            helm_set:
              - key: pu.memoryXtendVolume.enabled
                value: false
  - name: memoryxtend-storage
    display: 'MemoryXtend storage size'
    dependency:
      name: memoryxtend
      values:
        - true
    input_type: slider
    units: GB
    min_value: 1
    max_value: 2000
    step: 1
    default: 500
    components:
      - name: insightedge
        helm_set:
          - key: pu.memoryXtendVolume.volumeClaimTemplate.storage

hooks:
  post_install:
    - name: post-install-add-zeppelin-note
      provider: docker
      image: 'yoramw/add-zeppelin-note'
      command: ['/opt/scripts/run.sh']
      args:
        - "{{ account://vendor_company }}--{{account://end_company}}--insightedge-insightedge-zeppelin-service:9090"

